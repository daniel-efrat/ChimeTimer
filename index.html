<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChimeTimer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/svg+xml" href="favicon.png">
</head>
<body>
    <div class="wrapper">
        <div class="logo-wrapper">
            <img class="logo" src="logo.png" alt="">
        </div>
        <div class="container">
            <h1>Interval Timer</h1>
            <div id="countdown">00:00</div>
            <div class="controls">
                <label for="intervalInput">Interval (minutes): </label>
                <input type="number" id="intervalInput" min="1" value="5">
            </div>
            <div class="controls">
                <label for="soundSelect">Sounds: </label>
                <button id="toggleSoundOptions" class="arrow-down">Flute</button>
            </div>
            <div class="options-wrapper" id="soundOptionsWrapper" style="display: none;">
                <div class="sound-options" id="soundOptions">
                    <div class="sound-option" data-value="sounds/flute.mp3">
                        <div class="left">
                            <button class="play-button"><span class="play"></span></button>
                            <span>Flute</span>
                        </div>
                        <button class="select-button">Select</button>
                    </div>
                    <div class="sound-option" data-value="sounds/guitar.wav">
                        <div class="left">
                            <button class="play-button"><span class="play"></span></button>
                            <span>Guitar</span>
                        </div>
                        <button class="select-button">Select</button>
                    </div>
                    <div class="sound-option" data-value="sounds/harp.wav">
                        <div class="left">
                            <button class="play-button"><span class="play"></span></button>
                            <span>Harp</span>
                        </div>
                        <button class="select-button">Select</button>
                    </div>
                    <div class="sound-option" data-value="sounds/double-beep.wav">
                        <div class="left">
                            <button class="play-button"><span class="play"></span></button>
                            <span>Double Beep</span>
                        </div>
                        <button class="select-button">Select</button>
                    </div>
                    <div class="sound-option" data-value="sounds/bubble-pop.wav">
                        <div class="left">
                            <button class="play-button"><span class="play"></span></button>
                            <span>Bubble Pop</span>
                        </div>
                        <button class="select-button">Select</button>
                    </div>
                </div>
            </div>
            <div class="start-stop">
                <button id="startButton">Start</button>
                <button id="stopButton" disabled>Stop</button>
            </div>
            <div class="volume-control">
                <label for="volumeSlider" id="volume">Volume: </label>
                <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
            </div>
        </div>
    </div>
    <audio id="currentSound" preload="auto"></audio>
    <button id="hiddenButton" style="display:none;"></button>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const countdownElement = document.getElementById("countdown");
            const startButton = document.getElementById("startButton");
            const stopButton = document.getElementById("stopButton");
            const currentSound = document.getElementById("currentSound");
            const volumeSlider = document.getElementById("volumeSlider");
            const intervalInput = document.getElementById("intervalInput");
            const soundOptions = document.getElementById("soundOptions");
            const soundOptionsWrapper = document.getElementById("soundOptionsWrapper");
            const toggleSoundOptions = document.getElementById("toggleSoundOptions");
            const hiddenButton = document.getElementById("hiddenButton");
            let currentSoundName = 'Flute';
            let currentSoundFile = 'sounds/flute.mp3';

            let countdownInterval;
            let timeLeft;
            let interactionInterval;

            startButton.addEventListener("click", () => {
                timeLeft = parseInt(intervalInput.value) * 60;
                startButton.disabled = true;
                stopButton.disabled = false;
                startCountdown();
                currentSound.play();
                console.log(`Playing sound: ${currentSound.src}`);
                startSimulatingUserInteraction();
            });

            stopButton.addEventListener("click", () => {
                clearInterval(countdownInterval);
                clearInterval(interactionInterval);
                timeLeft = parseInt(intervalInput.value) * 60;
                updateCountdownDisplay();
                startButton.disabled = false;
                stopButton.disabled = true;
            });

            volumeSlider.addEventListener("input", () => {
                currentSound.volume = volumeSlider.value;
                console.log(`Volume set to: ${currentSound.volume}`);
            });

            toggleSoundOptions.addEventListener("click", () => {
                soundOptionsWrapper.style.display = soundOptionsWrapper.style.display === 'none' ? 'block' : 'none';
                toggleSoundOptions.classList.toggle('arrow-up');
                toggleSoundOptions.classList.toggle('arrow-down');
            });

            document.querySelectorAll('.play-button').forEach(button => {
                button.addEventListener("click", (e) => {
                    const soundFile = e.target.closest('.sound-option').getAttribute('data-value');
                    currentSound.src = soundFile;
                    currentSound.play().then(() => {
                        console.log(`Playing sound: ${currentSound.src}`);
                    }).catch(error => {
                        console.error(`Error playing sound: ${error}`);
                    });
                });
            });

            document.querySelectorAll('.select-button').forEach(button => {
                button.addEventListener("click", (e) => {
                    const optionElement = e.target.closest('.sound-option');
                    currentSoundName = optionElement.querySelector('span').textContent;
                    currentSoundFile = optionElement.getAttribute('data-value');
                    currentSound.src = currentSoundFile;
                    toggleSoundOptions.innerHTML = `${currentSoundName}`;
                    soundOptionsWrapper.style.display = 'none';
                    toggleSoundOptions.classList.remove('arrow-up');
                    toggleSoundOptions.classList.add('arrow-down');
                    updateSelectButtons();
                    console.log(`Selected sound: ${currentSoundFile}`);
                });
            });

            function updateSelectButtons() {
                document.querySelectorAll('.select-button').forEach(button => {
                    const optionElement = button.closest('.sound-option');
                    if (optionElement.getAttribute('data-value') === currentSoundFile) {
                        button.disabled = true;
                    } else {
                        button.disabled = false;
                    }
                });
            }

            function startCountdown() {
                countdownInterval = setInterval(() => {
                    if (timeLeft <= 0) {
                        clearInterval(countdownInterval);
                        currentSound.play().then(() => {
                            console.log(`Playing sound: ${currentSound.src}`);
                        }).catch(error => {
                            console.error(`Error playing sound: ${error}`);
                        });
                        timeLeft = parseInt(intervalInput.value) * 60; // reset timer
                        startCountdown(); // start the countdown again
                    }
                    updateCountdownDisplay();
                    timeLeft--;
                }, 1000);
            }

            function updateCountdownDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                countdownElement.textContent = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            }

            function startSimulatingUserInteraction() {
                console.log("Starting simulation of user interaction.");
                interactionInterval = setInterval(() => {
                    simulateClick(hiddenButton);
                    console.log("Simulated user interaction.");
                }, 30000); // Simulate interaction every 30 seconds
            }

            function simulateClick(element) {
                const event = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                element.dispatchEvent(event);
            }

            hiddenButton.addEventListener('click', () => {
                console.log('Hidden button clicked');
            });

            updateSelectButtons();
        });
    </script>
</body>
</html>
